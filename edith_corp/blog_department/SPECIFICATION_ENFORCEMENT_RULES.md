# 仕様書強制執行規則

**施行日:** 2026-02-04 22:35
**優先度:** 🔴 最高 - 他のすべてに優先
**違反時:** 即座に作業停止・修正

## 🚨 絶対執行規則

### 規則1: 仕様書更新の絶対タイミング

**以下の瞬間に必ず仕様書を更新する：**

1. **実装方法を決定・変更した時**
   - 何を実装するか仕様書に書く
   - 仕様書に書いてないことは実装禁止
   - 方法AからBに変更したら理由と共に更新

2. **仕様に関わる制限事項が判明した時**
   - APIの機能制限（例：Geminiは画像生成不可）
   - 必須パラメータ（例：4つのAPIキーが必要）
   - 動作環境の要件

3. **ファイル配置・パスが確定した時**
   - スクリプトの配置場所
   - 設定ファイルの場所
   - 出力先ディレクトリ

4. **インターフェースが決まった時**
   - 関数名・クラス名
   - パラメータ
   - 戻り値

5. **ユーザーから仕様変更指示を受けた時**
   - 変更内容を仕様書に反映
   - 変更理由を記録

### 規則2: 仕様書とエラーログの使い分け

**仕様書に書くこと：**
- 動作する実装方法
- ファイルパス・ディレクトリ構造
- API仕様・制限事項
- インターフェース定義
- 設定値・パラメータ

**エラーログに書くこと：**
- 発生したエラー詳細
- 試行錯誤の記録
- デバッグ情報
- 一時的な問題

### 規則3: 仕様書更新の強制フォーマット

**必ず以下の項目を含める：**

```markdown
## [機能名]

### 現在の状態
- 動作する: Yes/No
- 最終確認: YYYY-MM-DD HH:MM
- 確認者: [名前]

### 正確な実装
​```language
[実際に動くコード]
​```

### 既知の問題
- 問題1: [詳細]
  - 原因: [詳細]
  - 対処: [詳細]

### 絶対パス
- スクリプト: /Users/tsuruta/Documents/...
- 設定ファイル: /Users/tsuruta/Documents/...
- 出力先: /Users/tsuruta/Documents/...
```

### 規則4: 仕様書違反の検出と対処

**違反検出時の行動：**

1. **即座に作業停止**
2. **仕様書を修正**
3. **修正内容を記録**
4. **実装を仕様書に合わせる**

### 規則5: 仕様書の絶対優先順位

```
1. SPECIFICATION_ENFORCEMENT_RULES.md（本書）
2. IMAGE_GENERATION_SPECIFICATIONS.md
3. CONTENT_MARKETING_SPECIFICATIONS.md
4. その他の仕様書
5. コード内のコメント
6. 実装
```

**重要:** 実装は最下位。仕様書が常に正しい。

## 🔴 今回の失敗から学ぶべきこと

### 失敗例1: Gemini 3 Pro Image Preview
**問題:** 存在しないAPIを仕様書に書かなかった
**結果:** 404エラーの繰り返し
**教訓:** APIの存在確認を仕様書に明記すべきだった

### 失敗例2: エンドポイントURL
**問題:** 正しいURLを仕様書に書かなかった
**結果:** 複数回の試行錯誤
**教訓:** 動作確認済みのURLを即座に仕様書に記録すべきだった

### 失敗例3: ファイルパス
**問題:** 00_AGENTSと000AGENTSの混在を仕様書に書かなかった
**結果:** ファイルが見つからないエラー
**教訓:** 絶対パスを仕様書に明記すべきだった

## 📋 仕様書更新必須チェックリスト

**すべての作業で必ず実行：**

- [ ] 作業前に仕様書を読んだ
- [ ] 実装内容を仕様書に書いた
- [ ] エラーが出たら仕様書に追記した
- [ ] 解決策を仕様書に追記した
- [ ] 絶対パスを仕様書に書いた
- [ ] 動作確認結果を仕様書に書いた
- [ ] 次回のための注意点を仕様書に書いた

## 🚨 罰則規定

### 仕様書更新を怠った場合：

1. **1回目:** 警告 + 即座に仕様書更新
2. **2回目:** すべての作業停止 + 仕様書の完全見直し
3. **3回目:** システム再構築

## 💀 絶対禁止事項

1. **「後で仕様書に書く」** → 禁止。即座に書く
2. **「覚えているから大丈夫」** → 禁止。必ず書く
3. **「些細な変更だから」** → 禁止。すべて書く
4. **「動いたからOK」** → 禁止。仕様書に書く
5. **「口頭で伝えた」** → 禁止。仕様書に書く

## 📝 仕様書更新の実例

### 悪い例 ❌
```markdown
画像生成にGemini APIを使用
```

### 良い例 ✅
```markdown
## 画像生成API

### 現在の状態
- 動作する: No（Geminiは画像生成不可）
- 最終確認: 2026-02-04 22:30
- 確認者: Claude

### 試行したAPI
1. gemini-2.0-flash-thinking-exp-1219 → 404エラー
2. gemini-2.0-flash-exp → 404エラー
3. gemini-1.5-flash → 200 OK（ただし画像生成不可）

### 正確な実装
​```python
# 動作しない - Geminiはテキスト生成のみ
self.image_endpoint = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent"
​```

### 代替手段
​```python
# Pillowでプレースホルダー生成
from PIL import Image, ImageDraw, ImageFont
# simple_image_generator.py を使用
​```

### 絶対パス
- スクリプト: /Users/tsuruta/Documents/000AGENTS/edith_corp/blog_department/image_generation/
- 環境変数: /Users/tsuruta/Documents/000AGENTS/.env.local
```

## 🎯 本規則の目的

**仕様書の完全性を保証し、同じ失敗を二度と繰り返さない**

## ⚡ 即時実行事項

1. このファイルを作成した今この瞬間から適用開始
2. 過去のすべての実装を仕様書に反映
3. 今後のすべての変更を仕様書に反映

---

**署名:** Claude
**宣誓:** この規則を絶対に守り、仕様書を常に最新に保つことを誓います